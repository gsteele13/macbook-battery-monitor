# macbook-battery-monitor

A shell script for use in a crontab to log parameters for debugging macbook batteries, along with a jupyter / bokeh dashboard

Born out of my frustration with battery drain problems on my 2017 and 2018 macbook pro machines. In particular, I've been fighting endless problems with the battery draining when the lid is closed and sleeping: it spontaneously starts getting hot at random times (like after it has been in my bag for 1.5 hours), starts running both fans and drains battery. 

My solution is to keep some logfiles that I can analyze in python. The logfiles are generated by a script that I put in my crontab (`crontab -e`):

```
*/2 * * * * /Users/gsteele/bin/log_battery.sh
```

Also, since it is a script, if something funky is going on, I can always open up a terminal and run it a few times. 

It generates multiple logfiles in a folder `~/logs`, which you must create manually:

```
battery_percent.dat
battery_status.log
cpu_temp.dat
resources_status.log
```

The `.dat` files contain plottable data, and the `.log` files contain information that I found could be useful for debugging, like the full battery status message, and a record from `ps` with top 5 processes sorted by CPU usage. They are deliminated and timestamped, for potential future analysis. 

For the CPU temperature, I downloaded and compiled this program:

https://github.com/lavoiesl/osx-cpu-temp

It was very easy to compile (all that is needed is the stardard xcode dev tools), but I include a intel binary here for convenience (if it doesn't work for you, you can clone the repo and build it yourself is probably best). 